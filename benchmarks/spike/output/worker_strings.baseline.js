/* Generated by the Nim Compiler v2.2.6 */
var framePtr = null;
var excHandler = 0;
var lastJSError = null;
var NTI33555167 = {size: 0, kind: 17, base: null, node: null, finalizer: null};
var NTI33555175 = {size: 0, kind: 22, base: null, node: null, finalizer: null};
var NTI33554450 = {size: 0,kind: 29,base: null,node: null,finalizer: null};
var NTI33555174 = {size: 0, kind: 22, base: null, node: null, finalizer: null};
var NTI33555171 = {size: 0, kind: 17, base: null, node: null, finalizer: null};
var NTI33555172 = {size: 0, kind: 17, base: null, node: null, finalizer: null};
var NTI33554449 = {size: 0,kind: 28,base: null,node: null,finalizer: null};
var NNI33555172 = {kind: 2, len: 0, offset: 0, typ: null, name: null, sons: []};
NTI33555172.node = NNI33555172;
NTI33555174.base = NTI33555171;
NTI33555175.base = NTI33555171;
var NNI33555171 = {kind: 2, len: 5, offset: 0, typ: null, name: null, sons: [{kind: 1, offset: "parent", len: 0, typ: NTI33555174, name: "parent", sons: null},
{kind: 1, offset: "name", len: 0, typ: NTI33554450, name: "name", sons: null},
{kind: 1, offset: "message", len: 0, typ: NTI33554449, name: "msg", sons: null},
{kind: 1, offset: "trace", len: 0, typ: NTI33554449, name: "trace", sons: null},
{kind: 1, offset: "up", len: 0, typ: NTI33555175, name: "up", sons: null}]};
NTI33555171.node = NNI33555171;
var NNI33555167 = {kind: 2, len: 0, offset: 0, typ: null, name: null, sons: []};
NTI33555167.node = NNI33555167;
NTI33555171.base = NTI33555167;
NTI33555172.base = NTI33555171;

function setConstr() {
        var result = {};
    for (var i = 0; i < arguments.length; ++i) {
      var x = arguments[i];
      if (typeof(x) == "object") {
        for (var j = x[0]; j <= x[1]; ++j) {
          result[j] = true;
        }
      } else {
        result[x] = true;
      }
    }
    return result;


}
var ConstSet1 = setConstr(17, 16, 4, 18, 27, 19, 23, 22, 21);

function nimCopy(dest_p0, src_p1, ti_p2) {
  var result_33557352 = null;

    switch (ti_p2.kind) {
    case 21:
    case 22:
    case 23:
    case 5:
      if (!(isFatPointer__system_u2900(ti_p2))) {
      result_33557352 = src_p1;
      }
      else {
        result_33557352 = [src_p1[0], src_p1[1]];
      }

      break;
    case 19:
            if (dest_p0 === null || dest_p0 === undefined) {
        dest_p0 = {};
      }
      else {
        for (var key in dest_p0) { delete dest_p0[key]; }
      }
      for (var key in src_p1) { dest_p0[key] = src_p1[key]; }
      result_33557352 = dest_p0;

      break;
    case 18:
    case 17:
      if (!((ti_p2.base == null))) {
      result_33557352 = nimCopy(dest_p0, src_p1, ti_p2.base);
      }
      else {
      if ((ti_p2.kind == 17)) {
      result_33557352 = (dest_p0 === null || dest_p0 === undefined) ? {m_type: ti_p2} : dest_p0;
      }
      else {
        result_33557352 = (dest_p0 === null || dest_p0 === undefined) ? {} : dest_p0;
      }
      }
      nimCopyAux(result_33557352, src_p1, ti_p2.node);
      break;
    case 4:
    case 16:
            if(ArrayBuffer.isView(src_p1)) {
        if(dest_p0 === null || dest_p0 === undefined || dest_p0.length != src_p1.length) {
          dest_p0 = new src_p1.constructor(src_p1);
        } else {
          dest_p0.set(src_p1, 0);
        }
        result_33557352 = dest_p0;
      } else {
        if (src_p1 === null) {
          result_33557352 = null;
        }
        else {
          if (dest_p0 === null || dest_p0 === undefined || dest_p0.length != src_p1.length) {
            dest_p0 = new Array(src_p1.length);
          }
          result_33557352 = dest_p0;
          for (var i = 0; i < src_p1.length; ++i) {
            result_33557352[i] = nimCopy(result_33557352[i], src_p1[i], ti_p2.base);
          }
        }
      }

      break;
    case 24:
    case 27:
            if (src_p1 === null) {
        result_33557352 = null;
      }
      else {
        if (dest_p0 === null || dest_p0 === undefined || dest_p0.length != src_p1.length) {
          dest_p0 = new Array(src_p1.length);
        }
        result_33557352 = dest_p0;
        for (var i = 0; i < src_p1.length; ++i) {
          result_33557352[i] = nimCopy(result_33557352[i], src_p1[i], ti_p2.base);
        }
      }

      break;
    case 28:
            if (src_p1 !== null) {
        result_33557352 = src_p1.slice(0);
      }

      break;
    default:
      result_33557352 = src_p1;
      break;
    }

  return result_33557352;

}

function nimMax(a_p0, b_p1) {
    var Temporary1;

  var result_33557179 = 0;

  BeforeRet: {
    if ((b_p1 <= a_p0)) {
    Temporary1 = a_p0;
    }
    else {
    Temporary1 = b_p1;
    }

    result_33557179 = Temporary1;
    break BeforeRet;
  };

  return result_33557179;

}

function nimMin(a_p0, b_p1) {
    var Temporary1;

  var result_33557175 = 0;

  BeforeRet: {
    if ((a_p0 <= b_p1)) {
    Temporary1 = a_p0;
    }
    else {
    Temporary1 = b_p1;
    }

    result_33557175 = Temporary1;
    break BeforeRet;
  };

  return result_33557175;

}

function mnewString(len_p0) {
        var result = new Array(len_p0);
    for (var i = 0; i < len_p0; i++) {result[i] = 0;}
    return result;


}
var ConstSet2 = setConstr([97, 122]);

function isObj(obj_p0, subclass_p1) {
  var result_33557465 = false;

  BeforeRet: {
    var x_33557466 = obj_p0;
    if ((x_33557466 == subclass_p1)) {
    result_33557465 = true;
    break BeforeRet;
    }

    Label1: {
        Label2: while (true) {
        if (!!((x_33557466 == subclass_p1))) break Label2;
          if ((x_33557466 == null)) {
          result_33557465 = false;
          break BeforeRet;
          }

          x_33557466 = x_33557466.base;
        }
    };
    result_33557465 = true;
    break BeforeRet;
  };

  return result_33557465;

}

function toJSStr(s_p0) {
  var result_33556941 = null;

    var res_33556995 = newSeq__system_u2538((s_p0).length);
    var i_33556996 = 0;
    var j_33556997 = 0;
    Label1: {
        Label2: while (true) {
        if (!(i_33556996 < (s_p0).length)) break Label2;
          var c_33556998 = s_p0[i_33556996];
          if ((c_33556998 < 128)) {
          res_33556995[j_33556997] = String.fromCharCode(c_33556998);
          i_33556996 += 1;
          }
          else {
            var helper_33557024 = newSeq__system_u2538(0);
            Label3: {
                Label4: while (true) {
                if (!true) break Label4;
                  var code_33557025 = c_33556998.toString(16);
                  if ((((code_33557025) == null ? 0 : (code_33557025).length) == 1)) {
                  helper_33557024.push("%0");;
                  }
                  else {
                  helper_33557024.push("%");;
                  }

                  helper_33557024.push(code_33557025);;
                  i_33556996 += 1;
                  if ((((s_p0).length <= i_33556996) || (s_p0[i_33556996] < 128))) {
                  break Label3;
                  }

                  c_33556998 = s_p0[i_33556996];
                }
            };
++excHandler;
            try {
            res_33556995[j_33556997] = decodeURIComponent(helper_33557024.join(""));
--excHandler;
} catch (EXCEPTION) {
 var prevJSError = lastJSError;
 lastJSError = EXCEPTION;
 --excHandler;
            raiseDefect();
            res_33556995[j_33556997] = helper_33557024.join("");
            lastJSError = prevJSError;
            } finally {
            }
          }

          j_33556997 += 1;
        }
    };
    if (res_33556995.length < j_33556997) { for (var i = res_33556995.length ; i < j_33556997 ; ++i) res_33556995.push(null); }
               else { res_33556995.length = j_33556997; };
    result_33556941 = res_33556995.join("");

  return result_33556941;

}
var objectID_754974898 = [0];

function isFatPointer__system_u2900(ti_p0) {
  var result_33557334 = false;

  BeforeRet: {
    result_33557334 = !((ConstSet1[ti_p0.base.kind] != undefined));
    break BeforeRet;
  };

  return result_33557334;

}

function nimCopyAux(dest_p0, src_p1, n_p2) {
    switch (n_p2.kind) {
    case 0:
      break;
    case 1:
            dest_p0[n_p2.offset] = nimCopy(dest_p0[n_p2.offset], src_p1[n_p2.offset], n_p2.typ);

      break;
    case 2:
          for (var i = 0; i < n_p2.sons.length; i++) {
      nimCopyAux(dest_p0, src_p1, n_p2.sons[i]);
    }

      break;
    case 3:
            dest_p0[n_p2.offset] = nimCopy(dest_p0[n_p2.offset], src_p1[n_p2.offset], n_p2.typ);
      for (var i = 0; i < n_p2.sons.length; ++i) {
        nimCopyAux(dest_p0, src_p1, n_p2.sons[i][1]);
      }

      break;
    }


}

function nsuFindChar(s_p0, sub_p1, start_p2, last_p3) {
    var Temporary1;

  var result_956302948 = 0;

  BeforeRet: {
    result_956302948 = (-1);
    if ((last_p3 < 0)) {
    Temporary1 = (s_p0).length - 1;
    }
    else {
    Temporary1 = last_p3;
    }

    var last_956302949 = Temporary1;
    Label2: {
      var iHEX60gensym165_956302963 = 0;
      var colontmp__553648172 = 0;
      colontmp__553648172 = start_p2;
      var res_553648173 = colontmp__553648172;
      Label3: {
          Label4: while (true) {
          if (!(res_553648173 <= last_956302949)) break Label4;
            iHEX60gensym165_956302963 = res_553648173;
            if ((s_p0[iHEX60gensym165_956302963] == sub_p1)) {
            result_956302948 = iHEX60gensym165_956302963;
            break BeforeRet;
            }

            res_553648173 += 1;
          }
      };
    };
  };

  return result_956302948;

}

function substr__system_u3749(s_p0, first_p1, last_p2) {
  var result_33558185 = [];

    var first_33558186 = nimMax(first_p1, 0);
    var last_33558187 = nimMin(last_p2, (s_p0).length - 1);
    var L_33558188 = nimMax(((last_33558187 - first_33558186) + 1), 0);
    result_33558185 = nimCopy(null, mnewString(L_33558188), NTI33554449);
    Label1: {
      var i_33558198 = 0;
      var i_553648179 = 0;
      Label2: {
          Label3: while (true) {
          if (!(i_553648179 < L_33558188)) break Label3;
            i_33558198 = i_553648179;
            result_33558185[i_33558198] = s_p0[(i_33558198 + first_33558186)];
            i_553648179 += 1;
          }
      };
    };

  return result_33558185;

}

function substr__system_u3767(s_p0, first_p1) {
  var result_33558202 = [];

    result_33558202 = nimCopy(null, substr__system_u3749(s_p0, first_p1, (s_p0).length - 1), NTI33554449);

  return result_33558202;

}

function fill__pureZstrutils_u1555(a_p0, value_p1) {
    var xHEX60gensym161_956302876 = 0;
    Label1: {
        Label2: while (true) {
        if (!(xHEX60gensym161_956302876 <= (a_p0).length - 1)) break Label2;
          a_p0[xHEX60gensym161_956302876] = value_p1;
          xHEX60gensym161_956302876 += 1;
        }
    };


}

function nsuInitSkipTable(a_p0, sub_p1) {
    var m_956302866 = (sub_p1).length;
    fill__pureZstrutils_u1555(a_p0, m_956302866);
    Label1: {
      var i_956302886 = 0;
      var colontmp__553648182 = 0;
      colontmp__553648182 = (m_956302866 - 1);
      var i_553648183 = 0;
      Label2: {
          Label3: while (true) {
          if (!(i_553648183 < colontmp__553648182)) break Label3;
            i_956302886 = i_553648183;
            a_p0[sub_p1[i_956302886]] = ((m_956302866 - 1) - i_956302886);
            i_553648183 += 1;
          }
      };
    };


}

function nsuInitNewSkipTable(sub_p0) {
  var result_956302920 = [new Int32Array(256)];

    nsuInitSkipTable(result_956302920[0], sub_p0);

  return result_956302920[0];

}

function nsuFindStrA(a_p0, s_p1, sub_p2, start_p3, last_p4) {
    var Temporary1;

  var result_956302927 = 0;

  BeforeRet: {
    if ((last_p4 < 0)) {
    Temporary1 = (s_p1).length - 1;
    }
    else {
    Temporary1 = last_p4;
    }

    var last_956302928 = Temporary1;
    var subLast_956302929 = ((sub_p2).length - 1);
    if ((subLast_956302929 == (-1))) {
    result_956302927 = start_p3;
    break BeforeRet;
    }

    result_956302927 = (-1);
    var skip_956302930 = start_p3;
    Label2: {
        Label3: while (true) {
        if (!(subLast_956302929 <= (last_956302928 - skip_956302930))) break Label3;
          var i_956302931 = subLast_956302929;
          Label4: {
              Label5: while (true) {
              if (!(s_p1[(skip_956302930 + i_956302931)] == sub_p2[i_956302931])) break Label5;
                if ((i_956302931 == 0)) {
                result_956302927 = skip_956302930;
                break BeforeRet;
                }

                i_956302931 -= 1;
              }
          };
          skip_956302930 += a_p0[s_p1[(skip_956302930 + subLast_956302929)]];
        }
    };
  };

  return result_956302927;

}

function nsuReplaceStr(s_p0, sub_p1, by_p2) {
  var result_956303135 = [];

    result_956303135 = nimCopy(null, [], NTI33554449);
    var subLen_956303136 = (sub_p1).length;
    if ((subLen_956303136 == 0)) {
    result_956303135 = nimCopy(null, s_p0, NTI33554449);
    }
    else {
    if ((subLen_956303136 == 1)) {
    var c_956303137 = sub_p1[0];
    var last_956303138 = (s_p0).length - 1;
    var i_956303139 = 0;
    Label1: {
        Label2: while (true) {
        if (!true) break Label2;
          var j_956303140 = nsuFindChar(s_p0, c_956303137, i_956303139, last_956303138);
          if ((j_956303140 < 0)) {
          break Label1;
          }

          result_956303135.push.apply(result_956303135, substr__system_u3749(s_p0, i_956303139, (j_956303140 - 1)));;
          result_956303135.push.apply(result_956303135, by_p2);;
          i_956303139 = (j_956303140 + subLen_956303136);
        }
    };
    result_956303135.push.apply(result_956303135, substr__system_u3767(s_p0, i_956303139));;
    }
    else {
      var a_956303141 = nsuInitNewSkipTable(sub_p1);
      var last_956303142 = (s_p0).length - 1;
      var i_956303143 = 0;
      Label3: {
          Label4: while (true) {
          if (!true) break Label4;
            var j_956303144 = nsuFindStrA(a_956303141, s_p0, sub_p1, i_956303143, last_956303142);
            if ((j_956303144 < 0)) {
            break Label3;
            }

            result_956303135.push.apply(result_956303135, substr__system_u3749(s_p0, i_956303143, (j_956303144 - 1)));;
            result_956303135.push.apply(result_956303135, by_p2);;
            i_956303143 = (j_956303144 + subLen_956303136);
          }
      };
      result_956303135.push.apply(result_956303135, substr__system_u3767(s_p0, i_956303143));;
    }
    }

  return result_956303135;

}

function nsuToUpperAsciiChar(c_p0) {
  var result_956301418 = 0;

    if ((ConstSet2[c_p0] != undefined)) {
    result_956301418 = (c_p0 ^ 32);
    }
    else {
      result_956301418 = c_p0;
    }


  return result_956301418;

}

function nsuToUpperAsciiStr(s_p0) {
  var result_956301425 = [];

    result_956301425 = nimCopy(null, mnewString((s_p0).length), NTI33554449);
    Label1: {
      var iHEX60gensym11_956301431 = 0;
      var colontmp__553648189 = 0;
      colontmp__553648189 = ((s_p0).length - 1);
      var res_553648190 = 0;
      Label2: {
          Label3: while (true) {
          if (!(res_553648190 <= colontmp__553648189)) break Label3;
            iHEX60gensym11_956301431 = res_553648190;
            result_956301425[iHEX60gensym11_956301431] = nsuToUpperAsciiChar(s_p0[iHEX60gensym11_956301431]);
            res_553648190 += 1;
          }
      };
    };

  return result_956301425;

}

function sanitizeEnvVar__worker95strings_u12(name_p0) {
  var result_553648142 = [];

    result_553648142 = nimCopy(null, nsuReplaceStr(nsuReplaceStr(nsuToUpperAsciiStr(name_p0), [45], [95]), [46], [95]), NTI33554449);

  return result_553648142;

}

function newSeq__system_u2538(len_p0) {
  var result_33556974 = [];

    result_33556974 = new Array(len_p0); for (var i = 0 ; i < len_p0 ; ++i) { result_33556974[i] = null; }
  return result_33556974;

}

function isNimException__system_u2037() {
    return lastJSError && lastJSError.m_type;


}

function getCurrentException() {
  var result_33556472 = null;

    if (isNimException__system_u2037()) {
    result_33556472 = lastJSError;
    }


  return result_33556472;

}

function add__system_u1954(x_p0, x_p0_Idx, y_p1) {
          if (x_p0[x_p0_Idx] === null) { x_p0[x_p0_Idx] = []; }
      var off = x_p0[x_p0_Idx].length;
      x_p0[x_p0_Idx].length += y_p1.length;
      for (var i = 0; i < y_p1.length; ++i) {
        x_p0[x_p0_Idx][off+i] = y_p1.charCodeAt(i);
      }


}

function unhandledException(e_p0) {
    var buf_33556680 = [[]];
    if (!(((e_p0.message).length == 0))) {
    buf_33556680[0].push.apply(buf_33556680[0], [69,114,114,111,114,58,32,117,110,104,97,110,100,108,101,100,32,101,120,99,101,112,116,105,111,110,58,32]);;
    buf_33556680[0].push.apply(buf_33556680[0], e_p0.message);;
    }
    else {
    buf_33556680[0].push.apply(buf_33556680[0], [69,114,114,111,114,58,32,117,110,104,97,110,100,108,101,100,32,101,120,99,101,112,116,105,111,110]);;
    }

    buf_33556680[0].push.apply(buf_33556680[0], [32,91]);;
    add__system_u1954(buf_33556680, 0, e_p0.name);
    buf_33556680[0].push.apply(buf_33556680[0], [93,10]);;
    var cbuf_33556681 = toJSStr(buf_33556680[0]);
      if (typeof(Error) !== "undefined") {
    throw new Error(cbuf_33556681);
  }
  else {
    throw cbuf_33556681;
  }


}

function raiseDefect() {
    if (isNimException__system_u2037()) {
    var e_33556686 = getCurrentException();
    if (isObj(e_33556686.m_type, NTI33555172)) {
    if ((excHandler == 0)) {
    unhandledException(e_33556686);
    }

    throw e_33556686;
    }

    }


}

function fetch(request_p0, env_p1) {
  var result_553648146 = null;

  BeforeRet: {
    if ((request_p0.method == "OPTIONS")) {
    result_553648146 = new Response("", {status: 204});
    break BeforeRet;
    }

    var envKey_553648147 = sanitizeEnvVar__worker95strings_u12([111,112,101,110,97,105,45,107,101,121]);
    var msg_553648148 = ([123,34,101,110,118,95,107,101,121,34,58,34]).concat(envKey_553648147,[34,125]);
    result_553648146 = new Response(toJSStr(msg_553648148), {status: 200});
    break BeforeRet;
  };

  return result_553648146;

}
