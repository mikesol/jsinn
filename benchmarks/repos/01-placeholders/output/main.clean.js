var NTI134217747 = {size: 0, kind: 17, base: null, node: null, finalizer: null};
var NTI1191182502 = {size: 0, kind: 18, base: null, node: null, finalizer: null};
var NTI1191182421 = {size: 0, kind: 18, base: null, node: null, finalizer: null};
var NTI1124073495 = {size: 0, kind: 17, base: null, node: null, finalizer: null};
var NTI134217753 = {size: 0, kind: 17, base: null, node: null, finalizer: null};
var NTI33555173 = {size: 0, kind: 17, base: null, node: null, finalizer: null};
var NTI134217746 = {size: 0, kind: 17, base: null, node: null, finalizer: null};
var NTI33555167 = {size: 0, kind: 17, base: null, node: null, finalizer: null};
var NTI33555175 = {size: 0, kind: 22, base: null, node: null, finalizer: null};
var NTI33554450 = {size: 0,kind: 29,base: null,node: null,finalizer: null};
var NTI33555174 = {size: 0, kind: 22, base: null, node: null, finalizer: null};
var NTI33555171 = {size: 0, kind: 17, base: null, node: null, finalizer: null};
var NTI33555172 = {size: 0, kind: 17, base: null, node: null, finalizer: null};
var NTI1191182345 = {size: 0, kind: 18, base: null, node: null, finalizer: null};
var NTI1191182359 = {size: 0, kind: 18, base: null, node: null, finalizer: null};
var NTI973078942 = {size: 0, kind: 24, base: null, node: null, finalizer: null};
var NTI33554466 = {size: 0,kind: 1,base: null,node: null,finalizer: null};
var NTI33554445 = {size: 0,kind: 36,base: null,node: null,finalizer: null};
var NTI1224736771 = {size: 0, kind: 18, base: null, node: null, finalizer: null};
var NTI1140850692 = {size: 0, kind: 18, base: null, node: null, finalizer: null};
var NTI33554444 = {size: 0,kind: 44,base: null,node: null,finalizer: null};
var NTI754975095 = {size: 0, kind: 18, base: null, node: null, finalizer: null};
var NTI33554449 = {size: 0,kind: 28,base: null,node: null,finalizer: null};
var NTI33554435 = {size: 0,kind: 31,base: null,node: null,finalizer: null};
var NTI754974723 = {size: 0,kind: 31,base: null,node: null,finalizer: null};
var NTI1140850713 = {size: 0, kind: 18, base: null, node: null, finalizer: null};
var NTI1140850710 = {size: 0, kind: 24, base: null, node: null, finalizer: null};
var NTI1140850707 = {size: 0, kind: 18, base: null, node: null, finalizer: null};
var NNI1140850713 = {kind: 2, len: 4, offset: 0, typ: null, name: null, sons: [{kind: 1, offset: "Field0", len: 0, typ: NTI754974723, name: "Field0", sons: null}, 
{kind: 1, offset: "Field1", len: 0, typ: NTI33554435, name: "Field1", sons: null}, 
{kind: 1, offset: "Field2", len: 0, typ: NTI33554449, name: "Field2", sons: null}, 
{kind: 1, offset: "Field3", len: 0, typ: NTI33554449, name: "Field3", sons: null}]};
NTI1140850713.node = NNI1140850713;
NTI1140850710.base = NTI1140850713;
var NNI1140850707 = {kind: 2, len: 4, offset: 0, typ: null, name: null, sons: [{kind: 1, offset: "data", len: 0, typ: NTI1140850710, name: "data", sons: null}, 
{kind: 1, offset: "counter", len: 0, typ: NTI33554435, name: "counter", sons: null}, 
{kind: 1, offset: "first", len: 0, typ: NTI33554435, name: "first", sons: null}, 
{kind: 1, offset: "last", len: 0, typ: NTI33554435, name: "last", sons: null}]};
NTI1140850707.node = NNI1140850707;
var NNI754975095 = {kind: 2, len: 2, offset: 0, typ: null, name: null, sons: [{kind: 1, offset: "Field0", len: 0, typ: NTI33554444, name: "Field0", sons: null}, 
{kind: 1, offset: "Field1", len: 0, typ: NTI33554444, name: "Field1", sons: null}]};
NTI754975095.node = NNI754975095;
var NNI1140850692 = {kind: 2, len: 2, offset: 0, typ: null, name: null, sons: [{kind: 1, offset: "Field0", len: 0, typ: NTI33554449, name: "Field0", sons: null}, 
{kind: 1, offset: "Field1", len: 0, typ: NTI33554449, name: "Field1", sons: null}]};
NTI1140850692.node = NNI1140850692;
var NNI1224736771 = {kind: 2, len: 16, offset: 0, typ: null, name: null, sons: [{kind: 1, offset: "width", len: 0, typ: NTI33554435, name: "width", sons: null}, 
{kind: 1, offset: "height", len: 0, typ: NTI33554435, name: "height", sons: null}, 
{kind: 1, offset: "text", len: 0, typ: NTI33554449, name: "text", sons: null}, 
{kind: 1, offset: "fontFamily", len: 0, typ: NTI33554449, name: "fontFamily", sons: null}, 
{kind: 1, offset: "fontWeight", len: 0, typ: NTI33554449, name: "fontWeight", sons: null}, 
{kind: 1, offset: "fontSize", len: 0, typ: NTI33554435, name: "fontSize", sons: null}, 
{kind: 1, offset: "lineHeight", len: 0, typ: NTI33554445, name: "lineHeight", sons: null}, 
{kind: 1, offset: "dy", len: 0, typ: NTI33554445, name: "dy", sons: null}, 
{kind: 1, offset: "bgColor", len: 0, typ: NTI33554449, name: "bgColor", sons: null}, 
{kind: 1, offset: "textColor", len: 0, typ: NTI33554449, name: "textColor", sons: null}, 
{kind: 1, offset: "darkBgColor", len: 0, typ: NTI33554449, name: "darkBgColor", sons: null}, 
{kind: 1, offset: "darkTextColor", len: 0, typ: NTI33554449, name: "darkTextColor", sons: null}, 
{kind: 1, offset: "dataUri", len: 0, typ: NTI33554466, name: "dataUri", sons: null}, 
{kind: 1, offset: "charset", len: 0, typ: NTI33554449, name: "charset", sons: null}, 
{kind: 1, offset: "textWrap", len: 0, typ: NTI33554466, name: "textWrap", sons: null}, 
{kind: 1, offset: "padding", len: 0, typ: NTI33554449, name: "padding", sons: null}]};
NTI1224736771.node = NNI1224736771;
NTI973078942.base = NTI33554449;
var NNI1191182359 = {kind: 2, len: 2, offset: 0, typ: null, name: null, sons: [{kind: 1, offset: "val", len: 0, typ: NTI33554445, name: "val", sons: null}, 
{kind: 1, offset: "has", len: 0, typ: NTI33554466, name: "has", sons: null}]};
NTI1191182359.node = NNI1191182359;
var NNI1191182345 = {kind: 2, len: 2, offset: 0, typ: null, name: null, sons: [{kind: 1, offset: "val", len: 0, typ: NTI33554445, name: "val", sons: null}, 
{kind: 1, offset: "has", len: 0, typ: NTI33554466, name: "has", sons: null}]};
NTI1191182345.node = NNI1191182345;
var NNI33555172 = {kind: 2, len: 0, offset: 0, typ: null, name: null, sons: []};
NTI33555172.node = NNI33555172;
NTI33555174.base = NTI33555171;
NTI33555175.base = NTI33555171;
var NNI33555171 = {kind: 2, len: 5, offset: 0, typ: null, name: null, sons: [{kind: 1, offset: "parent", len: 0, typ: NTI33555174, name: "parent", sons: null}, 
{kind: 1, offset: "name", len: 0, typ: NTI33554450, name: "name", sons: null}, 
{kind: 1, offset: "message", len: 0, typ: NTI33554449, name: "msg", sons: null}, 
{kind: 1, offset: "trace", len: 0, typ: NTI33554449, name: "trace", sons: null}, 
{kind: 1, offset: "up", len: 0, typ: NTI33555175, name: "up", sons: null}]};
NTI33555171.node = NNI33555171;
var NNI33555167 = {kind: 2, len: 0, offset: 0, typ: null, name: null, sons: []};
NTI33555167.node = NNI33555167;
NTI33555171.base = NTI33555167;
NTI33555172.base = NTI33555171;
var NNI134217746 = {kind: 2, len: 0, offset: 0, typ: null, name: null, sons: []};
NTI134217746.node = NNI134217746;
var NNI33555173 = {kind: 2, len: 0, offset: 0, typ: null, name: null, sons: []};
NTI33555173.node = NNI33555173;
NTI33555173.base = NTI33555171;
NTI134217746.base = NTI33555173;
var NNI134217753 = {kind: 2, len: 0, offset: 0, typ: null, name: null, sons: []};
NTI134217753.node = NNI134217753;
NTI134217753.base = NTI33555172;
var NNI1124073495 = {kind: 2, len: 0, offset: 0, typ: null, name: null, sons: []};
NTI1124073495.node = NNI1124073495;
NTI1124073495.base = NTI33555172;
var NNI1191182421 = {kind: 2, len: 2, offset: 0, typ: null, name: null, sons: [{kind: 1, offset: "val", len: 0, typ: NTI33554449, name: "val", sons: null}, 
{kind: 1, offset: "has", len: 0, typ: NTI33554466, name: "has", sons: null}]};
NTI1191182421.node = NNI1191182421;
var NNI1191182502 = {kind: 2, len: 2, offset: 0, typ: null, name: null, sons: [{kind: 1, offset: "val", len: 0, typ: NTI33554449, name: "val", sons: null}, 
{kind: 1, offset: "has", len: 0, typ: NTI33554466, name: "has", sons: null}]};
NTI1191182502.node = NNI1191182502;
var NNI134217747 = {kind: 2, len: 0, offset: 0, typ: null, name: null, sons: []};
NTI134217747.node = NNI134217747;
NTI134217747.base = NTI134217746;

function setConstr() {
        var result = {};
    for (var i = 0; i < arguments.length; ++i) {
      var x = arguments[i];
      if (typeof(x) == "object") {
        for (var j = x[0]; j <= x[1]; ++j) {
          result[j] = true;
        }
      } else {
        result[x] = true;
      }
    }
}
var ConstSet1 = setConstr(17, 16, 4, 18, 27, 19, 23, 22, 21);

function nimCopy(dest, src, ti) {

    switch (ti.kind) {
    case 21:
    case 22:
    case 23:
    case 5:
      if (!(isFatPointer(ti))) {
      return src;
      }
      else {
        return [src[0], src[1]];
      }
      
      break;
    case 19:
            if (dest === null || dest === undefined) {
        dest = {};
      }
      else {
        for (var key in dest) { delete dest[key]; }
      }
      for (var key in src) { dest[key] = src[key]; }
      return dest;
    
      break;
    case 18:
    case 17:
      if (!((ti.base == null))) {
      return nimCopy(dest, src, ti.base);
      }
      else {
      if ((ti.kind == 17)) {
      return (dest === null || dest === undefined) ? {m_type: ti} : dest;
      }
      else {
        return (dest === null || dest === undefined) ? {} : dest;
      }
      }
      nimCopyAux(result, src, ti.node);
      break;
    case 4:
    case 16:
            if(ArrayBuffer.isView(src)) { 
        if(dest === null || dest === undefined || dest.length != src.length) {
          dest = new src.constructor(src);
        } else {
          dest.set(src, 0);
        }
        return dest;
      } else {
        if (src === null) {
          return null;
        }
        else {
          if (dest === null || dest === undefined || dest.length != src.length) {
            dest = new Array(src.length);
          }
          return dest;
          for (var i = 0; i < src.length; ++i) {
            result[i] = nimCopy(result[i], src[i], ti.base);
          }
        }
      }
    
      break;
    case 24:
    case 27:
            if (src === null) {
        return null;
      }
      else {
        if (dest === null || dest === undefined || dest.length != src.length) {
          dest = new Array(src.length);
        }
        return dest;
        for (var i = 0; i < src.length; ++i) {
          result[i] = nimCopy(result[i], src[i], ti.base);
        }
      }
    
      break;
    case 28:
            if (src !== null) {
        return src.slice(0);
      }
    
      break;
    default: 
      return src;
      break;
    }
}

function eqStrings(a, b) {
        if (a == b) return true;
    if (a === null && b.length == 0) return true;
    if (b === null && a.length == 0) return true;
    if ((!a) || (!b)) return false;
    var alen = a.length;
    if (alen != b.length) return false;
    for (var i = 0; i < alen; ++i)
      if (a[i] != b[i]) return false;
    return true;
  
  
}

function makeNimstrLit(c) {
      var result = [];
  for (var i = 0; i < c.length; ++i) {
    result[i] = c.charCodeAt(i);
  }
}

function cstrToNimstr(c) {
      var ln = c.length;
  var result = new Array(ln);
  var r = 0;
  for (var i = 0; i < ln; ++i) {
    var ch = c.charCodeAt(i);

    if (ch < 128) {
      result[r] = ch;
    }
    else {
      if (ch < 2048) {
        result[r] = (ch >> 6) | 192;
      }
      else {
        if (ch < 55296 || ch >= 57344) {
          result[r] = (ch >> 12) | 224;
        }
        else {
            ++i;
            ch = 65536 + (((ch & 1023) << 10) | (c.charCodeAt(i) & 1023));
            result[r] = (ch >> 18) | 240;
            ++r;
            result[r] = ((ch >> 12) & 63) | 128;
        }
        ++r;
        result[r] = ((ch >> 6) & 63) | 128;
      }
      ++r;
      result[r] = (ch & 63) | 128;
    }
    ++r;
  }
}

function nimMin(a, b) {
    var Temporary1;

  var result = 0;

    if ((a <= b)) {
    Temporary1 = a;
    }
    else {
    Temporary1 = b;
    }
    
    return Temporary1;
}

function mnewString(len) {
        var result = new Array(len);
    for (var i = 0; i < len; i++) {result[i] = 0;}
}

function nimMax(a, b) {
    var Temporary1;

  var result = 0;

    if ((b <= a)) {
    Temporary1 = a;
    }
    else {
    Temporary1 = b;
    }
    
    return Temporary1;
}
var ConstSet2 = setConstr(32, 9, 11, 13, 10, 12);
var ConstSet3 = setConstr([97, 122], [65, 90], [48, 57], 95);
var ConstSet4 = setConstr([97, 122], [65, 90], [48, 57], 95);

function addChar(x, c) {
    x.push(c);
  
}
var ConstSet5 = setConstr([48, 57]);
var ConstSet6 = setConstr([48, 57]);
var ConstSet7 = setConstr(101, 69);
var ConstSet8 = setConstr([48, 57]);
var ConstSet9 = setConstr([48, 57]);

function isObj(obj, subclass) {
  var result = false;

    var x = obj;
    if ((x == subclass)) {
    return true;
    }
    
    Label1: {
        Label2: while (true) {
        if (!!((x == subclass))) break Label2;
          if ((x == null)) {
          return false;
          }
          
          x = x.base;
        }

    return true;
}

function toJSStr(s) {

    var res = newSeq((s).length);
    var i = 0;
    var j = 0;
    Label1: {
        Label2: while (true) {
        if (!(i < (s).length)) break Label2;
          var c = s[i];
          if ((c < 128)) {
          res[j] = String.fromCharCode(c);
          i += 1;
          }
          else {
            var helper = newSeq(0);
            Label3: {
                Label4: while (true) {
                if (!true) break Label4;
                  var code = c.toString(16);
                  if ((((code) == null ? 0 : (code).length) == 1)) {
                  helper.push("%0");;
                  }
                  else {
                  helper.push("%");;
                  }
                  
                  helper.push(code);;
                  i += 1;
                  if ((((s).length <= i) || (s[i] < 128))) {
                  break Label3;
                  }
                  
                  c = s[i];
                }

++excHandler;
            try {
            res[j] = decodeURIComponent(helper.join(""));
--excHandler;
} catch (EXCEPTION) {
 var prevJSError = lastJSError;
 lastJSError = EXCEPTION;
 --excHandler;
            raiseDefect();
            res[j] = helper.join("");
            lastJSError = prevJSError;
            } finally {
            }
          }
          
          j += 1;
        }

    if (res.length < j) { for (var i = res.length ; i < j ; ++i) res.push(null); }
               else { res.length = j; };
    return res.join("");
}

function nimParseBiggestFloat(s, number, number_Idx) {
    var Temporary1;

  var result = 0;

    var sign = false;
    var i = 0;
    if ((s[i] == 43)) {
    i += 1;
    }
    else {
    if ((s[i] == 45)) {
    sign = true;
    i += 1;
    }
    }
    if (((s[i] == 78) || (s[i] == 110))) {
    if (((s[(i + 1)] == 65) || (s[(i + 1)] == 97))) {
    if (((s[(i + 2)] == 78) || (s[(i + 2)] == 110))) {
    if (!((ConstSet3[s[(i + 3)]] != undefined))) {
    number[number_Idx] = NaN;
    return (i + 3);
    }
    
    }
    
    }
    
    return 0;
    }
    
    if (((s[i] == 73) || (s[i] == 105))) {
    if (((s[(i + 1)] == 78) || (s[(i + 1)] == 110))) {
    if (((s[(i + 2)] == 70) || (s[(i + 2)] == 102))) {
    if (!((ConstSet4[s[(i + 3)]] != undefined))) {
    if (sign) {
    Temporary1 = -Infinity;
    }
    else {
    Temporary1 = Infinity;
    }
    
    number[number_Idx] = Temporary1;
    return (i + 3);
    }
    
    }
    
    }
    
    return 0;
    }
    
    var buf = [];
    if (sign) {
    addChar(buf, 45);;
    }
    
    Label2: {
        Label3: while (true) {
        if (!(ConstSet5[s[i]] != undefined)) break Label3;
          addChar(buf, s[i]);;
          i += 1;
          Label4: {
              Label5: while (true) {
              if (!(s[i] == 95)) break Label5;
                i += 1;
              }
        }

    if ((s[i] == 46)) {
    addChar(buf, s[i]);;
    i += 1;
    Label6: {
        Label7: while (true) {
        if (!(ConstSet6[s[i]] != undefined)) break Label7;
          addChar(buf, s[i]);;
          i += 1;
          Label8: {
              Label9: while (true) {
              if (!(s[i] == 95)) break Label9;
                i += 1;
              }
        }
    }
    
    if (((buf).length == (sign ? 1 : 0))) {
    return 0;
    }
    
    if ((ConstSet7[s[i]] != undefined)) {
    addChar(buf, s[i]);;
    i += 1;
    if ((s[i] == 43)) {
    i += 1;
    }
    else {
    if ((s[i] == 45)) {
    addChar(buf, s[i]);;
    i += 1;
    }
    }
    if (!((ConstSet8[s[i]] != undefined))) {
    return 0;
    }
    
    Label10: {
        Label11: while (true) {
        if (!(ConstSet9[s[i]] != undefined)) break Label11;
          addChar(buf, s[i]);;
          i += 1;
          Label12: {
              Label13: while (true) {
              if (!(s[i] == 95)) break Label13;
                i += 1;
              }
        }
    }
    
    number[number_Idx] = parseFloatNative(buf);
    return i;
}

function raiseException(e, ename) {
    e.name = ename;
    if ((excHandler == 0)) {
    unhandledException(e);
    }
    
    throw e;
  
}

function reraiseException() {
    if ((lastJSError == null)) {
    raiseException({message: [110,111,32,101,120,99,101,112,116,105,111,110,32,116,111,32,114,101,114,97,105,115,101], parent: null, m_type: NTI134217753, name: null, trace: [], up: null}, "ReraiseDefect");
    }
    else {
      if ((excHandler == 0)) {
      if (isNimException()) {
      unhandledException(lastJSError);
      }
      
      }
      
      throw lastJSError;
    }
    
  
}
var ConstSet10 = setConstr([65, 90]);
            var namedColors = [[98,108,97,99,107], [119,104,105,116,101], [114,101,100], [103,114,101,101,110], [98,108,117,101], [121,101,108,108,111,119], [99,121,97,110], [109,97,103,101,110,116,97], [103,114,97,121], [103,114,101,121], [111,114,97,110,103,101], [112,117,114,112,108,101], [112,105,110,107], [98,114,111,119,110], [116,114,97,110,115,112,97,114,101,110,116], [105,110,104,101,114,105,116], [99,117,114,114,101,110,116,99,111,108,111,114]];
              var xmlEscapeMap = {data: [{Field0: 0, Field1: 0, Field2: []}, {Field0: 0, Field1: 0, Field2: []}, {Field0: 0, Field1: 0, Field2: []}, {Field0: 0, Field1: 0, Field2: []}, {Field0: 0, Field1: 0, Field2: []}, {Field0: 0, Field1: 0, Field2: []}, {Field0: 0, Field1: 0, Field2: []}, {Field0: 478495127, Field1: 38, Field2: [38,97,109,112,59]}, {Field0: 878621656, Field1: 62, Field2: [38,103,116,59]}, {Field0: 0, Field1: 0, Field2: []}, {Field0: 0, Field1: 0, Field2: []}, {Field0: (-431180709), Field1: 34, Field2: [38,113,117,111,116,59]}, {Field0: 0, Field1: 0, Field2: []}, {Field0: (-1839864179), Field1: 39, Field2: [38,97,112,111,115,59]}, {Field0: 0, Field1: 0, Field2: []}, {Field0: 1536979647, Field1: 60, Field2: [38,108,116,59]}], counter: 5};

function nimCharToStr(x) {
  var result = [];

    return nimCopy(null, mnewString(1), NTI33554449);
    result[0] = x;
}

function isFatPointer(ti) {
  var result = false;

    return !((ConstSet1[ti.base.kind] != undefined));
}

function nimCopyAux(dest, src, n) {
    switch (n.kind) {
    case 0:
      break;
    case 1:
            dest[n.offset] = nimCopy(dest[n.offset], src[n.offset], n.typ);
    
      break;
    case 2:
          for (var i = 0; i < n.sons.length; i++) {
      nimCopyAux(dest, src, n.sons[i]);
    }
    
      break;
    case 3:
            dest[n.offset] = nimCopy(dest[n.offset], src[n.offset], n.typ);
      for (var i = 0; i < n.sons.length; ++i) {
        nimCopyAux(dest, src, n.sons[i][1]);
      }
    
      break;
    }
  
}

function nextPowerOfTwo(x) {
  var result = 0;

    return (x - 1);
    return (result | (result >> 16));
    return (result | (result >> 8));
    return (result | (result >> 4));
    return (result | (result >> 2));
    return (result | (result >> 1));
    result += (1 + ((x <= 0) ? 1 : 0));
}

function slotsNeeded(count) {
  var result = 0;

    return nextPowerOfTwo(((Math.trunc(count / 2) + count) + 4));
}

function initOrderedTable(initialSize) {
  var result = ({data: [], counter: 0, first: 0, last: 0});

    return nimCopy(result, ({data: [], counter: 0, first: 0, last: 0}), NTI1140850707);
    var correctSizeHEX60gensym0 = slotsNeeded(initialSize);
    result.counter = 0;
    result.data = new Array(correctSizeHEX60gensym0); for (var i = 0 ; i < correctSizeHEX60gensym0 ; ++i) { result.data[i] = {Field0: 0, Field1: 0, Field2: [], Field3: []}; }    result.first = (-1);
    result.last = (-1);
}

function lenU(s) {
  var result = 0n;

    return BigInt.asUintN(64, BigInt((s).length));
}

function load8e(s, o) {
  var result = 0n;

    return (((((((BigInt.asUintN(64, BigInt(s[(o + 7)]) << BigInt(56)) | BigInt.asUintN(64, BigInt(s[(o + 6)]) << BigInt(48))) | BigInt.asUintN(64, BigInt(s[(o + 5)]) << BigInt(40))) | BigInt.asUintN(64, BigInt(s[(o + 4)]) << BigInt(32))) | BigInt.asUintN(64, BigInt(s[(o + 3)]) << BigInt(24))) | BigInt.asUintN(64, BigInt(s[(o + 2)]) << BigInt(16))) | BigInt.asUintN(64, BigInt(s[(o + 1)]) << BigInt(8))) | BigInt(s[(o + 0)]));
}

function load8(s, o) {
  var result = 0n;

    return load8e(s, o);
}

function rotR(v, bits) {
  var result = 0n;

    return ((v >> BigInt(bits)) | BigInt.asUintN(64, v << BigInt((64 - bits))));
}

function len16(u, v, mul) {
  var result = 0n;

    var a = BigInt.asUintN(64, ((u ^ v) * mul));
    a = (a ^ (a >> BigInt(47)));
    var b = BigInt.asUintN(64, ((v ^ a) * mul));
    b = (b ^ (b >> BigInt(47)));
    return BigInt.asUintN(64, (b * mul));
}

function load4e(s, o) {
  var result = 0;

    return (((((((((s[(o + 3)] >>> 0) << 24) >>> 0) | (((s[(o + 2)] >>> 0) << 16) >>> 0)) >>> 0) | (((s[(o + 1)] >>> 0) << 8) >>> 0)) >>> 0) | (s[(o + 0)] >>> 0)) >>> 0);
}

function load4(s, o) {
  var result = 0;

    return load4e(s, o);
}

function shiftMix(v) {
  var result = 0n;

    return (v ^ (v >> BigInt(47)));
}

function len0_16(s) {
    var Temporary1;

  var result = 0n;

    if ((8 <= (s).length)) {
    var mul = BigInt.asUintN(64, (11160318154034397263n + BigInt.asUintN(64, (2n * lenU(s)))));
    var a = BigInt.asUintN(64, (load8(s, 0) + 11160318154034397263n));
    var b = load8(s, ((s).length - 8));
    var c = BigInt.asUintN(64, (BigInt.asUintN(64, (rotR(b, 37) * mul)) + a));
    var d = BigInt.asUintN(64, (BigInt.asUintN(64, (rotR(a, 25) + b)) * mul));
    Temporary1 = len16(c, d, mul);
    }
    else {
    if ((4 <= (s).length)) {
    var mul = BigInt.asUintN(64, (11160318154034397263n + BigInt.asUintN(64, (2n * lenU(s)))));
    var a = BigInt(load4(s, 0));
    Temporary1 = len16(BigInt.asUintN(64, (lenU(s) + BigInt.asUintN(64, a << BigInt(3)))), BigInt(load4(s, ((s).length - 4))), mul);
    }
    else {
    if ((0 < (s).length)) {
    var a = (s[0] >>> 0);
    var b = (s[((s).length >> 1)] >>> 0);
    var c = (s[((s).length - 1)] >>> 0);
    var y = ((a + ((b << 8) >>> 0)) >>> 0);
    var z = BigInt.asUintN(64, (lenU(s) + BigInt(((c << 2) >>> 0))));
    Temporary1 = BigInt.asUintN(64, (shiftMix((BigInt.asUintN(64, (BigInt(y) * 11160318154034397263n)) ^ BigInt.asUintN(64, (z * 14097894508562428199n)))) * 11160318154034397263n));
    }
    else {
    Temporary1 = 11160318154034397263n;
    }
    }}
    return Temporary1;
}

function len17_32(s) {
  var result = 0n;

    var mul = BigInt.asUintN(64, (11160318154034397263n + BigInt.asUintN(64, (2n * lenU(s)))));
    var a = BigInt.asUintN(64, (load8(s, 0) * 13011662864482103923n));
    var b = load8(s, 8);
    var c = BigInt.asUintN(64, (load8(s, ((s).length - 8)) * mul));
    var d = BigInt.asUintN(64, (load8(s, ((s).length - 16)) * 11160318154034397263n));
    return len16(BigInt.asUintN(64, (BigInt.asUintN(64, (rotR(BigInt.asUintN(64, (a + b)), 43) + rotR(c, 30))) + d)), BigInt.asUintN(64, (BigInt.asUintN(64, (a + rotR(BigInt.asUintN(64, (b + 11160318154034397263n)), 18))) + c)), mul);
}

function len33_64(s) {
  var result = 0n;

    var mul = BigInt.asUintN(64, (11160318154034397263n + BigInt.asUintN(64, (2n * lenU(s)))));
    var a = BigInt.asUintN(64, (load8(s, 0) * 11160318154034397263n));
    var b = load8(s, 8);
    var c = BigInt.asUintN(64, (load8(s, ((s).length - 8)) * mul));
    var d = BigInt.asUintN(64, (load8(s, ((s).length - 16)) * 11160318154034397263n));
    var y = BigInt.asUintN(64, (BigInt.asUintN(64, (rotR(BigInt.asUintN(64, (a + b)), 43) + rotR(c, 30))) + d));
    var z = len16(y, BigInt.asUintN(64, (BigInt.asUintN(64, (a + rotR(BigInt.asUintN(64, (b + 11160318154034397263n)), 18))) + c)), mul);
    var e = BigInt.asUintN(64, (load8(s, 16) * mul));
    var f = load8(s, 24);
    var g = BigInt.asUintN(64, (BigInt.asUintN(64, (y + load8(s, ((s).length - 32)))) * mul));
    var h = BigInt.asUintN(64, (BigInt.asUintN(64, (z + load8(s, ((s).length - 24)))) * mul));
    return len16(BigInt.asUintN(64, (BigInt.asUintN(64, (rotR(BigInt.asUintN(64, (e + f)), 43) + rotR(g, 30))) + h)), BigInt.asUintN(64, (BigInt.asUintN(64, (e + rotR(BigInt.asUintN(64, (f + a)), 18))) + g)), mul);
}

function weakLen32withSeeds2(w, x, y, z, a, b) {
  var result = {Field0: 0n, Field1: 0n};

    var a = BigInt.asUintN(64, (a + w));
    var b = rotR(BigInt.asUintN(64, (BigInt.asUintN(64, (b + a)) + z)), 21);
    var c = a;
    a = BigInt.asUintN(64, a + BigInt(x));
    a = BigInt.asUintN(64, a + BigInt(y));
    b = BigInt.asUintN(64, b + BigInt(rotR(a, 44)));
    result["Field0"] = BigInt.asUintN(64, (a + z));
    result["Field1"] = BigInt.asUintN(64, (b + c));
}

function weakLen32withSeeds(s, o, a, b) {
  var result = {Field0: 0n, Field1: 0n};

    return nimCopy(result, weakLen32withSeeds2(load8(s, o), load8(s, (o + 8)), load8(s, (o + 16)), load8(s, (o + 24)), a, b), NTI754975095);
}

function hashFarm(s) {
  var result = 0n;

    if (((s).length <= 16)) {
    return len0_16(s);
    }
    
    if (((s).length <= 32)) {
    return len17_32(s);
    }
    
    if (((s).length <= 64)) {
    return len33_64(s);
    }
    
    var o = 0;
    var x = 81n;
    var y = 2480279821605975764n;
    var z = BigInt.asUintN(64, (shiftMix(BigInt.asUintN(64, (BigInt.asUintN(64, (y * 11160318154034397263n)) + 113n))) * 11160318154034397263n));
    var v = nimCopy(null, {Field0: 0n, Field1: 0n}, NTI754975095);
    var w = nimCopy(null, {Field0: 0n, Field1: 0n}, NTI754975095);
    x = BigInt.asUintN(64, (BigInt.asUintN(64, (x * 11160318154034397263n)) + load8(s, 0)));
    var eos = (Math.trunc(((s).length - 1) / 64) * 64);
    var last64 = ((eos + (((s).length - 1) & 63)) - 63);
    Label1: {
        Label2: while (true) {
        if (!true) break Label2;
          x = BigInt.asUintN(64, (rotR(BigInt.asUintN(64, (BigInt.asUintN(64, (BigInt.asUintN(64, (x + y)) + v["Field0"])) + load8(s, (o + 8)))), 37) * 13011662864482103923n));
          y = BigInt.asUintN(64, (rotR(BigInt.asUintN(64, (BigInt.asUintN(64, (y + v["Field1"])) + load8(s, (o + 48)))), 42) * 13011662864482103923n));
          x = (x ^ w["Field1"]);
          y = BigInt.asUintN(64, y + BigInt(BigInt.asUintN(64, (v["Field0"] + load8(s, (o + 40))))));
          z = BigInt.asUintN(64, (rotR(BigInt.asUintN(64, (z + w["Field0"])), 33) * 13011662864482103923n));
          v = nimCopy(v, weakLen32withSeeds(s, (o + 0), BigInt.asUintN(64, (v["Field1"] * 13011662864482103923n)), BigInt.asUintN(64, (x + w["Field0"]))), NTI754975095);
          w = nimCopy(w, weakLen32withSeeds(s, (o + 32), BigInt.asUintN(64, (z + w["Field1"])), BigInt.asUintN(64, (y + load8(s, (o + 16))))), NTI754975095);
          var HEX3Atmp = z;
          z = x;
          x = HEX3Atmp;
          o += 64;
          if ((o == eos)) {
          break Label1;
          }
          
        }

    var mul = BigInt.asUintN(64, (13011662864482103923n + BigInt.asUintN(64, (z & 255n) << BigInt(1))));
    o = last64;
    w["Field0"] = BigInt.asUintN(64, w["Field0"] + BigInt((BigInt.asUintN(64, (lenU(s) - 1n)) & 63n)));
    v["Field0"] = BigInt.asUintN(64, v["Field0"] + BigInt(w["Field0"]));
    w["Field0"] = BigInt.asUintN(64, w["Field0"] + BigInt(v["Field0"]));
    x = BigInt.asUintN(64, (rotR(BigInt.asUintN(64, (BigInt.asUintN(64, (BigInt.asUintN(64, (x + y)) + v["Field0"])) + load8(s, (o + 8)))), 37) * mul));
    y = BigInt.asUintN(64, (rotR(BigInt.asUintN(64, (BigInt.asUintN(64, (y + v["Field1"])) + load8(s, (o + 48)))), 42) * mul));
    x = (x ^ BigInt.asUintN(64, (w["Field1"] * 9n)));
    y = BigInt.asUintN(64, y + BigInt(BigInt.asUintN(64, (BigInt.asUintN(64, (v["Field0"] * 9n)) + load8(s, (o + 40))))));
    z = BigInt.asUintN(64, (rotR(BigInt.asUintN(64, (z + w["Field0"])), 33) * mul));
    v = nimCopy(v, weakLen32withSeeds(s, (o + 0), BigInt.asUintN(64, (v["Field1"] * mul)), BigInt.asUintN(64, (x + w["Field0"]))), NTI754975095);
    w = nimCopy(w, weakLen32withSeeds(s, (o + 32), BigInt.asUintN(64, (z + w["Field1"])), BigInt.asUintN(64, (y + load8(s, (o + 16))))), NTI754975095);
    var HEX3Atmp = z;
    z = x;
    x = HEX3Atmp;
    return len16(BigInt.asUintN(64, (BigInt.asUintN(64, (len16(v["Field0"], w["Field0"], mul) + BigInt.asUintN(64, (shiftMix(y) * 14097894508562428199n)))) + z)), BigInt.asUintN(64, (len16(v["Field1"], w["Field1"], mul) + x)), mul);
}

function hash(x) {
  var result = 0;

    return Number(BigInt.asIntN(32, hashFarm((x.slice(0, (x).length - 1 + 1)))));
}

function isFilled(hcode) {
  var result = false;

    return !((hcode == 0));
}

function nextTry(h, maxHash) {
  var result = 0;

    return ((h + 1) & maxHash);
}

function rawGet(t, key, hc, hc_Idx) {
  var result = 0;

    hc[hc_Idx] = hash(key);
    if ((hc[hc_Idx] == 0)) {
    hc[hc_Idx] = 314159265;
    }
    
    if (((t.data).length == 0)) {
    return (-1);
    }
    
    var h = (hc[hc_Idx] & (t.data).length - 1);
    Label1: {
        Label2: while (true) {
        if (!isFilled(t.data[h].Field0)) break Label2;
          if (((t.data[h].Field0 == hc[hc_Idx]) && eqStrings(t.data[h].Field2, key))) {
          return h;
          }
          
          h = nextTry(h, (t.data).length - 1);
        }

    return ((-1) - h);
}

function mustRehash(t) {
  var result = false;

    return (((t.data).length < (t.counter + Math.trunc(t.counter / 2))) || (((t.data).length - t.counter) < 4));
}

function rawInsert(t, data, data_Idx, key, val, hc, h) {
    data[data_Idx][h].Field2 = nimCopy(null, key, NTI33554449);
    data[data_Idx][h].Field3 = nimCopy(null, val, NTI33554449);
    data[data_Idx][h].Field0 = hc;
    data[data_Idx][h].Field1 = (-1);
    if ((t.first < 0)) {
    t.first = h;
    }
    
    if ((0 <= t.last)) {
    data[data_Idx][t.last].Field1 = h;
    }
    
    t.last = h;
  
}

function enlarge(t) {
          var Temporary5;
          var Temporary6;

    var n = [];
    n = new Array(((t.data).length * 2)); for (var i = 0 ; i < ((t.data).length * 2) ; ++i) { n[i] = {Field0: 0, Field1: 0, Field2: [], Field3: []}; }    var h = t.first;
    t.first = (-1);
    t.last = (-1);
    var HEX3Atmp = nimCopy(null, t.data, NTI1140850710);
    t.data = n;
    n = HEX3Atmp;
    Label1: {
        Label2: while (true) {
        if (!(0 <= h)) break Label2;
          var nxt = n[h].Field1;
          var eh = n[h].Field0;
          if (isFilled(eh)) {
          var j = (eh & (t.data).length - 1);
          Label3: {
              Label4: while (true) {
              if (!isFilled(t.data[j].Field0)) break Label4;
                j = nextTry(j, (t.data).length - 1);
              }

          Temporary5 = n[h].Field2;
          n[h].Field2 = [];
          Temporary6 = n[h].Field3;
          n[h].Field3 = [];
          rawInsert(t, t, "data", Temporary5, Temporary6, n[h].Field0, j);
          }
          
          h = nxt;
        }
}

function rawGetKnownHC(t, key, hc) {
  var result = 0;

    if (((t.data).length == 0)) {
    return (-1);
    }
    
    var h = (hc & (t.data).length - 1);
    Label1: {
        Label2: while (true) {
        if (!isFilled(t.data[h].Field0)) break Label2;
          if (((t.data[h].Field0 == hc) && eqStrings(t.data[h].Field2, key))) {
          return h;
          }
          
          h = nextTry(h, (t.data).length - 1);
        }

    return ((-1) - h);
}

function HEX5BHEX5DHEX3D(t, key, val) {
    if (((t.data).length == 0)) {
    var correctSizeHEX60gensym3 = slotsNeeded(32);
    t.counter = 0;
    t.data = new Array(correctSizeHEX60gensym3); for (var i = 0 ; i < correctSizeHEX60gensym3 ; ++i) { t.data[i] = {Field0: 0, Field1: 0, Field2: [], Field3: []}; }    t.first = (-1);
    t.last = (-1);
    }
    
    var hc = [0];
    var index = rawGet(t, key, hc, 0);
    if ((0 <= index)) {
    t.data[index].Field3 = nimCopy(null, val, NTI33554449);
    }
    else {
      if (((t.data).length == 0)) {
      var correctSizeHEX60gensym8 = slotsNeeded(32);
      t.counter = 0;
      t.data = new Array(correctSizeHEX60gensym8); for (var i = 0 ; i < correctSizeHEX60gensym8 ; ++i) { t.data[i] = {Field0: 0, Field1: 0, Field2: [], Field3: []}; }      t.first = (-1);
      t.last = (-1);
      }
      
      if (mustRehash(t)) {
      enlarge(t);
      index = rawGetKnownHC(t, key, hc[0]);
      }
      
      index = ((-1) - index);
      rawInsert(t, t, "data", key, val, hc[0], index);
      t.counter += 1;
    }
    
  
}

function toOrderedTable(pairs) {
  var result = [({data: [], counter: 0, first: 0, last: 0})];

    result[0] = nimCopy(result[0], initOrderedTable((pairs).length), NTI1140850707);
    Label1: {
      var key = [];
      var val = [];
      var i = 0;
      Label2: {
          Label3: while (true) {
          if (!(i < (pairs).length)) break Label3;
            key = pairs[i]["Field0"];
            val = pairs[i]["Field1"];
            HEX5BHEX5DHEX3D(result[0], key, val);
            i += 1;
          }

  return result[0];
}
var addHeaders = toOrderedTable([nimCopy(null, {Field0: [88,45,88,83,83,45,80,114,111,116,101,99,116,105,111,110], Field1: [49,59,32,109,111,100,101,61,98,108,111,99,107]}, NTI1140850692), nimCopy(null, {Field0: [88,45,70,114,97,109,101,45,79,112,116,105,111,110,115], Field1: [68,69,78,89]}, NTI1140850692), nimCopy(null, {Field0: [88,45,67,111,110,116,101,110,116,45,84,121,112,101,45,79,112,116,105,111,110,115], Field1: [110,111,115,110,105,102,102]}, NTI1140850692), nimCopy(null, {Field0: [82,101,102,101,114,114,101,114,45,80,111,108,105,99,121], Field1: [110,111,45,114,101,102,101,114,114,101,114,45,119,104,101,110,45,100,111,119,110,103,114,97,100,101]}, NTI1140850692), nimCopy(null, {Field0: [83,116,114,105,99,116,45,84,114,97,110,115,112,111,114,116,45,83,101,99,117,114,105,116,121], Field1: [109,97,120,45,97,103,101,61,51,49,53,51,54,48,48,48,59,32,105,110,99,108,117,100,101,83,117,98,68,111,109,97,105,110,115,59,32,112,114,101,108,111,97,100]}, NTI1140850692), nimCopy(null, {Field0: [70,101,97,116,117,114,101,45,80,111,108,105,99,121], Field1: makeNimstrLit("geolocation \'none\'; midi \'none\'; sync-xhr \'none\'; microphone \'none\'; camera \'none\'; magnetometer \'none\'; gyroscope \'none\'; speaker \'none\'; fullscreen \'none\'; payment \'none\';")}, NTI1140850692), nimCopy(null, {Field0: [67,111,110,116,101,110,116,45,83,101,99,117,114,105,116,121,45,80,111,108,105,99,121], Field1: makeNimstrLit("default-src \'self\'; script-src \'self\' cdnjs.cloudflare.com static.cloudflareinsights.com; style-src \'self\' cdnjs.cloudflare.com \'unsafe-inline\' fonts.googleapis.com; img-src \'self\' data: images.placeholders.dev; child-src \'none\'; font-src \'self\' fonts.gstatic.com cdnjs.cloudflare.com; connect-src \'self\'; prefetch-src \'none\'; object-src \'none\'; form-action \'none\'; frame-ancestors \'none\'; upgrade-insecure-requests;")}, NTI1140850692)]);
var imageCacheHeader = [112,117,98,108,105,99,44,32,109,97,120,45,97,103,101,61,55,55,55,54,48,48,48];
var errorCacheHeader = [112,117,98,108,105,99,44,32,109,97,120,45,97,103,101,61,51,48,48];

function nsuStartsWith(s, prefix) {
  var result = false;

    return false;
    var prefixLenHEX60gensym135 = (prefix).length;
    var sLenHEX60gensym135 = (s).length;
    var iHEX60gensym135 = 0;
    Label1: {
        Label2: while (true) {
        if (!true) break Label2;
          if ((prefixLenHEX60gensym135 <= iHEX60gensym135)) {
          return true;
          }
          
          if (((sLenHEX60gensym135 <= iHEX60gensym135) || !((s[iHEX60gensym135] == prefix[iHEX60gensym135])))) {
          return false;
          }
          
          iHEX60gensym135 += 1;
        }
}

function addChars(result, result_Idx, x, start, n) {
    var Temporary1;

    var old = (result[result_Idx]).length;
    if (result[result_Idx].length < (Temporary1 = (old + n), Temporary1)) { for (var i = result[result_Idx].length; i < Temporary1; ++i) result[result_Idx].push(0); }
         else {result[result_Idx].length = Temporary1; };
    Label2: {
      var iHEX60gensym4 = 0;
      var i = 0;
      Label3: {
          Label4: while (true) {
          if (!(i < n)) break Label4;
            iHEX60gensym4 = i;
            result[result_Idx][(old + iHEX60gensym4)] = x.charCodeAt((start + iHEX60gensym4));
            i += 1;
          }
}

function addChars(result, result_Idx, x) {
    addChars(result, result_Idx, x, 0, ((x) == null ? 0 : (x).length));
  
}

function addInt(result, result_Idx, x) {
    addChars(result, result_Idx, ((x) + ""));
  
}

function addInt(result, result_Idx, x) {
    addInt(result, result_Idx, BigInt(x));
  
}

function HEX24(xHEX60gensym0) {
  var result = [[]];

    result[0] = nimCopy(null, [], NTI33554449);
    addInt(result, 0, xHEX60gensym0);

  return result[0];
}

function defaultOptions(width, height) {
  var result = ({width: 0, height: 0, text: [], fontFamily: [], fontWeight: [], fontSize: 0, lineHeight: 0.0, dy: 0.0, bgColor: [], textColor: [], darkBgColor: [], darkTextColor: [], dataUri: false, charset: [], textWrap: false, padding: []});

    var fs = Number(BigInt(Math.trunc(Math.floor((nimMin(width, height) * 0.2)))));
    return nimCopy(result, {width: width, height: height, text: (HEX24(width)).concat([195,151],HEX24(height)), fontFamily: [115,97,110,115,45,115,101,114,105,102], fontWeight: [98,111,108,100], fontSize: fs, lineHeight: 1.2, dy: (fs * 0.35), bgColor: [35,100,100,100], textColor: [114,103,98,97,40,48,44,48,44,48,44,48,46,53,41], darkBgColor: [], darkTextColor: [], dataUri: true, charset: [85,84,70,45,56], textWrap: false, padding: [48,46,53,101,109]}, NTI1224736771);
}

function nsuFindChar(s, sub, start, last) {
    var Temporary1;

  var result = 0;

    return (-1);
    if ((last < 0)) {
    Temporary1 = (s).length - 1;
    }
    else {
    Temporary1 = last;
    }
    
    var last = Temporary1;
    Label2: {
      var iHEX60gensym165 = 0;
      var colontmp_ = 0;
      colontmp_ = start;
      var res = colontmp_;
      Label3: {
          Label4: while (true) {
          if (!(res <= last)) break Label4;
            iHEX60gensym165 = res;
            if ((s[iHEX60gensym165] == sub)) {
            return iHEX60gensym165;
            }
            
            res += 1;
          }
}

function substr(s, first, last) {
  var result = [];

    var first = nimMax(first, 0);
    var last = nimMin(last, (s).length - 1);
    var L = nimMax(((last - first) + 1), 0);
    return nimCopy(null, mnewString(L), NTI33554449);
    Label1: {
      var i = 0;
      var i = 0;
      Label2: {
          Label3: while (true) {
          if (!(i < L)) break Label3;
            i = i;
            result[i] = s[(i + first)];
            i += 1;
          }
}

function substr(s, first) {
  var result = [];

    return nimCopy(null, substr(s, first, (s).length - 1), NTI33554449);
}

function fill(a, value) {
    var xHEX60gensym161 = 0;
    Label1: {
        Label2: while (true) {
        if (!(xHEX60gensym161 <= (a).length - 1)) break Label2;
          a[xHEX60gensym161] = value;
          xHEX60gensym161 += 1;
        }
}

function nsuInitSkipTable(a, sub) {
    var m = (sub).length;
    fill(a, m);
    Label1: {
      var i = 0;
      var colontmp_ = 0;
      colontmp_ = (m - 1);
      var i = 0;
      Label2: {
          Label3: while (true) {
          if (!(i < colontmp_)) break Label3;
            i = i;
            a[sub[i]] = ((m - 1) - i);
            i += 1;
          }
}

function nsuInitNewSkipTable(sub) {
  var result = [new Int32Array(256)];

    nsuInitSkipTable(result[0], sub);

  return result[0];
}

function nsuFindStrA(a, s, sub, start, last) {
    var Temporary1;

  var result = 0;

    if ((last < 0)) {
    Temporary1 = (s).length - 1;
    }
    else {
    Temporary1 = last;
    }
    
    var last = Temporary1;
    var subLast = ((sub).length - 1);
    if ((subLast == (-1))) {
    return start;
    }
    
    return (-1);
    var skip = start;
    Label2: {
        Label3: while (true) {
        if (!(subLast <= (last - skip))) break Label3;
          var i = subLast;
          Label4: {
              Label5: while (true) {
              if (!(s[(skip + i)] == sub[i])) break Label5;
                if ((i == 0)) {
                return skip;
                }
                
                i -= 1;
              }

          skip += a[s[(skip + subLast)]];
        }
}

function nsuReplaceStr(s, sub, by) {
  var result = [];

    return nimCopy(null, [], NTI33554449);
    var subLen = (sub).length;
    if ((subLen == 0)) {
    return nimCopy(null, s, NTI33554449);
    }
    else {
    if ((subLen == 1)) {
    var c = sub[0];
    var last = (s).length - 1;
    var i = 0;
    Label1: {
        Label2: while (true) {
        if (!true) break Label2;
          var j = nsuFindChar(s, c, i, last);
          if ((j < 0)) {
          break Label1;
          }
          
          result.push.apply(result, substr(s, i, (j - 1)));;
          result.push.apply(result, by);;
          i = (j + subLen);
        }

    result.push.apply(result, substr(s, i));;
    }
    else {
      var a = nsuInitNewSkipTable(sub);
      var last = (s).length - 1;
      var i = 0;
      Label3: {
          Label4: while (true) {
          if (!true) break Label4;
            var j = nsuFindStrA(a, s, sub, i, last);
            if ((j < 0)) {
            break Label3;
            }
            
            result.push.apply(result, substr(s, i, (j - 1)));;
            result.push.apply(result, by);;
            i = (j + subLen);
          }

      result.push.apply(result, substr(s, i));;
    }
    }
}

function substrEq(s, pos, substr) {
    var Temporary1;

  var result = false;

    var length = (substr).length;
    if ((0 < length)) {
    var i = 0;
    Label2: {
        Label3: while (true) {
        if (!(((i < length) && ((pos + i) < (s).length)) && (s[(pos + i)] == substr[i]))) break Label3;
          i += 1;
        }

    Temporary1 = (i == length);
    }
    else {
    Temporary1 = false;
    }
    
    return Temporary1;
}

function nsuSplitString(s, sep, maxsplit) {
      var Temporary2;

  var result = [];

    return nimCopy(null, [], NTI973078942);
    Label1: {
      var xHEX60gensym69 = [];
      if (((sep).length == 0)) {
      Temporary2 = 1;
      }
      else {
      Temporary2 = (sep).length;
      }
      
      var sepLen = Temporary2;
      var lastHEX60gensym41 = 0;
      var splitsHEX60gensym41 = maxsplit;
      Label3: {
          Label4: while (true) {
          if (!(lastHEX60gensym41 <= (s).length)) break Label4;
            var firstHEX60gensym41 = lastHEX60gensym41;
            Label5: {
                Label6: while (true) {
                if (!((lastHEX60gensym41 < (s).length) && !(substrEq(s, lastHEX60gensym41, sep)))) break Label6;
                  lastHEX60gensym41 += 1;
                }

            if ((splitsHEX60gensym41 == 0)) {
            lastHEX60gensym41 = (s).length;
            }
            
            xHEX60gensym69 = substr(s, firstHEX60gensym41, (lastHEX60gensym41 - 1));
            var Temporary7 = nimCopy(null, xHEX60gensym69, NTI33554449);
            result.push(Temporary7);;
            if ((splitsHEX60gensym41 == 0)) {
            break Label3;
            }
            
            splitsHEX60gensym41 -= 1;
            lastHEX60gensym41 += sepLen;
          }
}

function nsuStrip(s, leading, trailing, chars) {
  var result = [];

    var first = 0;
    var last = ((s).length - 1);
    if (leading) {
    Label1: {
        Label2: while (true) {
        if (!((first <= last) && (chars[s[first]] != undefined))) break Label2;
          first += 1;
        }
    }
    
    if (trailing) {
    Label3: {
        Label4: while (true) {
        if (!((first <= last) && (chars[s[last]] != undefined))) break Label4;
          last -= 1;
        }
    }
    
    return nimCopy(null, substr(s, first, last), NTI33554449);
}

function none() {
  var result = ({val: 0.0, has: false});

    return nimCopy(result, {val: 0.0, has: false}, NTI1191182359);
}

function newSeq(len) {
  var result = [];

    result = new Array(len); for (var i = 0 ; i < len ; ++i) { result[i] = null; }
}

function isNimException() {
    return lastJSError && lastJSError.m_type;
  
}

function getCurrentException() {

    if (isNimException()) {
    return lastJSError;
    }
}

function add(x, x_Idx, y) {
          if (x[x_Idx] === null) { x[x_Idx] = []; }
      var off = x[x_Idx].length;
      x[x_Idx].length += y.length;
      for (var i = 0; i < y.length; ++i) {
        x[x_Idx][off+i] = y.charCodeAt(i);
      }
    
  
}

function unhandledException(e) {
    var buf = [[]];
    if (!(((e.message).length == 0))) {
    buf[0].push.apply(buf[0], [69,114,114,111,114,58,32,117,110,104,97,110,100,108,101,100,32,101,120,99,101,112,116,105,111,110,58,32]);;
    buf[0].push.apply(buf[0], e.message);;
    }
    else {
    buf[0].push.apply(buf[0], [69,114,114,111,114,58,32,117,110,104,97,110,100,108,101,100,32,101,120,99,101,112,116,105,111,110]);;
    }
    
    buf[0].push.apply(buf[0], [32,91]);;
    add(buf, 0, e.name);
    buf[0].push.apply(buf[0], [93,10]);;
    var cbuf = toJSStr(buf[0]);
      if (typeof(Error) !== "undefined") {
    throw new Error(cbuf);
  }
  else {
    throw cbuf;
  }
  
  
}

function raiseDefect() {
    if (isNimException()) {
    var e = getCurrentException();
    if (isObj(e.m_type, NTI33555172)) {
    if ((excHandler == 0)) {
    unhandledException(e);
    }
    
    throw e;
    }
    
    }
    
  
}

function parseFloatNative(a) {
  var result = 0.0;

    var str = [];
    Label1: {
      var x = 0;
      var i = 0;
      Label2: {
          Label3: while (true) {
          if (!(i < (a).length)) break Label3;
            x = a[i];
            addChar(str, x);;
            i += 1;
          }

    var cstr = toJSStr(str);
      return Number(cstr);
}

function npuParseFloat(s, number, number_Idx) {
  var result = 0;

    var bf = [0.0];
    return nimParseBiggestFloat(s, bf, 0);
    if (!((result == 0))) {
    number[number_Idx] = bf[0];
    }
}

function parseFloat(s, number, number_Idx, start) {
  var result = 0;

    return npuParseFloat((s.slice(start, (s).length - 1 + 1)), number, number_Idx);
}

function nsuParseFloat(s) {
  var result = [0.0];

    result[0] = 0.0;
    var L = parseFloat(s, result, 0, 0);
    if ((!((L == (s).length)) || (L == 0))) {
    raiseException({message: ([105,110,118,97,108,105,100,32,102,108,111,97,116,58,32]).concat(s), parent: null, m_type: NTI134217746, name: null, trace: [], up: null}, "ValueError");
    }
    

  return result[0];
}

function some(val) {
  var result = ({val: 0.0, has: false});

    return nimCopy(result, {has: true, val: val}, NTI1191182345);
}

function sanitizeNumber(input) {
  var result = ({val: 0.0, has: false});

    var s = nsuStrip(input, true, true, ConstSet2);
    if (((s).length == 0)) {
    return nimCopy(result, none(), NTI1191182345);
    }
    
++excHandler;
    try {
    var n = nsuParseFloat(s);
    return nimCopy(result, some(n), NTI1191182345);
--excHandler;
} catch (EXCEPTION) {
 var prevJSError = lastJSError;
 lastJSError = EXCEPTION;
 --excHandler;
    if (lastJSError && (isObj(lastJSError.m_type, NTI134217746))) {
    return nimCopy(result, none(), NTI1191182345);
    }
    else {
    	reraiseException();
    }
    lastJSError = prevJSError;
    } finally {
    }
}

function isSome(self) {
  var result = false;

    return self.has;
}

function isNone(self) {
  var result = false;

    return !(self.has);
}

function get(self) {
  var result = 0.0;

    if (isNone(self)) {
    raiseException({message: [67,97,110,39,116,32,111,98,116,97,105,110,32,97,32,118,97,108,117,101,32,102,114,111,109,32,97,32,96,110,111,110,101,96], parent: null, m_type: NTI1124073495, name: null, trace: [], up: null}, "UnpackDefect");
    }
    
    return self["val"];
}

function stripHtmlTags(s) {

    return s.replace(new RegExp("<[^>]*>", "g"), "");
}

function sanitizeString(input) {
  var result = [];

    var value = cstrToNimstr(stripHtmlTags(toJSStr(input)));
    value = nimCopy(null, cstrToNimstr(toJSStr(value).replace(new RegExp("[\"<>]+", "g"), "")), NTI33554449);
    return nimCopy(null, value, NTI33554449);
}

function sanitizeStringForCss(input) {
  var result = [];

    var value = sanitizeString(input);
    value = nimCopy(null, cstrToNimstr(toJSStr(value).replace(new RegExp("[:;]+", "g"), "")), NTI33554449);
    return nimCopy(null, value, NTI33554449);
}

function contains(pattern, self) {
  var result = false;

    return self.test(pattern);
}

function some(val) {
  var result = ({val: [], has: false});

    return nimCopy(result, {has: true, val: nimCopy(null, val, NTI33554449)}, NTI1191182421);
}

function nsuToLowerAsciiChar(c) {
  var result = 0;

    if ((ConstSet10[c] != undefined)) {
    return (c ^ 32);
    }
    else {
      return c;
    }
}

function nsuToLowerAsciiStr(s) {
  var result = [];

    return nimCopy(null, mnewString((s).length), NTI33554449);
    Label1: {
      var iHEX60gensym7 = 0;
      var colontmp_ = 0;
      colontmp_ = ((s).length - 1);
      var res = 0;
      Label2: {
          Label3: while (true) {
          if (!(res <= colontmp_)) break Label3;
            iHEX60gensym7 = res;
            result[iHEX60gensym7] = nsuToLowerAsciiChar(s[iHEX60gensym7]);
            res += 1;
          }
}

function none() {
  var result = ({val: [], has: false});

    return nimCopy(result, {val: [], has: false}, NTI1191182502);
}

function sanitizeColor(input) {
  var result = ({val: [], has: false});

    var value = sanitizeString(input);
    if (contains(toJSStr(value), new RegExp("^#([0-9a-fA-F]{3}|[0-9a-fA-F]{6}|[0-9a-fA-F]{8})$"))) {
    return nimCopy(result, some(value), NTI1191182421);
    }
    
    if (contains(toJSStr(value), new RegExp("^(rgb|rgba|hsl|hsla)\\("))) {
    return nimCopy(result, some(value), NTI1191182421);
    }
    
    var lower = nsuToLowerAsciiStr(value);
    Label1: {
      var c = [];
      var i = 0;
      Label2: {
          Label3: while (true) {
          if (!true) break Label3;
            c = namedColors[i];
            if (eqStrings(lower, c)) {
            return nimCopy(result, some(value), NTI1191182421);
            }
            
            if ((16 <= i)) {
            break Label2;
            }
            
            i += 1;
          }

    return nimCopy(result, none(), NTI1191182421);
}

function isSome(self) {
  var result = false;

    return self.has;
}

function isNone(self) {
  var result = false;

    return !(self.has);
}

function get(self) {
  var result = [];

    if (isNone(self)) {
    raiseException({message: [67,97,110,39,116,32,111,98,116,97,105,110,32,97,32,118,97,108,117,101,32,102,114,111,109,32,97,32,96,110,111,110,101,96], parent: null, m_type: NTI1124073495, name: null, trace: [], up: null}, "UnpackDefect");
    }
    
    return self["val"];
}

function hasJsBigInt() {
  var result = false;

    return typeof BigInt != 'undefined';
}

function hiXorLoJs(a, b) {
  var result = 0n;

    var prod = (a * b);
    var mask = BigInt("0xffffffffffffffff");
    return ((prod >> BigInt("64")) ^ (prod & mask));
}

function hashWangYi1(x) {
  var result = 0;

    if (hasJsBigInt()) {
    var P0HEX60gensym4 = BigInt("0xa0761d6478bd642f");
    var P1HEX60gensym4 = BigInt("0xe7037ed1a0b428db");
    var P58HEX60gensym4 = BigInt("0xeb44accab455d16d");
    var resHEX60gensym4 = hiXorLoJs(hiXorLoJs(P0HEX60gensym4, (BigInt(x) ^ P1HEX60gensym4)), P58HEX60gensym4);
    return Number((() => { const i = resHEX60gensym4, b = 32; return BigInt.asIntN(b, i) })());
    }
    else {
      return (Number(BigInt.asIntN(32, x)) & Number(BigInt.asIntN(32, 4294967295n)));
    }
}

function hash(x) {
  var result = 0;

    return hashWangYi1(BigInt.asUintN(64, BigInt(x)));
}

function rawGet(t, key, hc, hc_Idx) {
  var result = 0;

    hc[hc_Idx] = hash(key);
    if ((hc[hc_Idx] == 0)) {
    hc[hc_Idx] = 314159265;
    }
    
    if (((t.data).length == 0)) {
    return (-1);
    }
    
    var h = (hc[hc_Idx] & (t.data).length - 1);
    Label1: {
        Label2: while (true) {
        if (!isFilled(t.data[h].Field0)) break Label2;
          if (((t.data[h].Field0 == hc[hc_Idx]) && (t.data[h].Field1 == key))) {
          return h;
          }
          
          h = nextTry(h, (t.data).length - 1);
        }

    return ((-1) - h);
}

function hasKey(t, key) {
  var result = false;

    var hc = [0];
    return (0 <= rawGet(t, key, hc, 0));
}

function contains(t, key) {
  var result = false;

    return hasKey(t, key);
}

function raiseKeyError(key) {
    raiseException({message: ([107,101,121,32,110,111,116,32,102,111,117,110,100,58,32]).concat(nimCharToStr(key)), parent: null, m_type: NTI134217747, name: null, trace: [], up: null}, "KeyError");
  
}

function HEX5BHEX5D(t, key) {
  var result = [];

    var hcHEX60gensym20 = [0];
    var indexHEX60gensym20 = rawGet(t, key, hcHEX60gensym20, 0);
    if ((0 <= indexHEX60gensym20)) {
    return t.data[indexHEX60gensym20]["Field2"];
    }
    else {
    raiseKeyError(key);
    }
}

function escapeXml(s) {
  var result = [];

    return nimCopy(null, [], NTI33554449);
    Label1: {
      var ch = 0;
      var i = 0;
      var L = (s).length;
      Label2: {
          Label3: while (true) {
          if (!(i < L)) break Label3;
            ch = s[i];
            if (contains(xmlEscapeMap, ch)) {
            result.push.apply(result, HEX5BHEX5D(xmlEscapeMap, ch));;
            }
            else {
            addChar(result, ch);;
            }
            
            i += 1;
          }
}

function nimFloatToString(a) {

          function nimOnlyDigitsOrMinus(n) {
        return n.toString().match(/^-?\d+$/);
      }
      if (Number.isSafeInteger(a))
        return a === 0 && 1 / a < 0 ? "-0.0" : a+".0";
      else if (isNaN(a)) // Number.isNaN is since ES6
        result = "nan";  // or it'll be "NaN"
      else if (!isFinite(a)) // Number.isFinite newer but unnecessary here
        result = a > 0 ? "inf" : "-inf";  // or it'll be [-]Infinity
      else {
        return a+"";
        if(nimOnlyDigitsOrMinus(result)){
          return a+".0";
        }
      }
}

function addFloat(result, result_Idx, x) {
    add(result, result_Idx, nimFloatToString(x));
  
}

function HEX24(x) {
  var result = [[]];

    result[0] = nimCopy(null, [], NTI33554449);
    addFloat(result, 0, x);

  return result[0];
}

function toHexImpl(x, len, handleNegative) {
  var result = [];

    var n = x;
    return nimCopy(null, mnewString(len), NTI33554449);
    Label1: {
      var j = 0;
      var colontmp_ = 0;
      colontmp_ = (len - 1);
      var res = colontmp_;
      Label2: {
          Label3: while (true) {
          if (!(0 <= res)) break Label3;
            j = res;
            result[j] = [48,49,50,51,52,53,54,55,56,57,65,66,67,68,69,70][Number((n & 15n))];
            n = (n >> BigInt(4));
            if (((n == 0n) && handleNegative)) {
            n = 18446744073709551615n;
            }
            
            res -= 1;
          }
}

function toHex(x, len) {
  var result = [];

    return nimCopy(null, toHexImpl(BigInt.asUintN(64, BigInt(x)), len, (x < 0)), NTI33554449);
}

function encodeUrl(s, usePlus) {
    var Temporary1;

  var result = [];

    return nimCopy(null, mnewString(0), NTI33554449);
    if (usePlus) {
    Temporary1 = [43];
    }
    else {
    Temporary1 = [37,50,48];
    }
    
    var fromSpace = nimCopy(null, Temporary1, NTI33554449);
    Label2: {
      var c = 0;
      var i = 0;
      var L = (s).length;
      Label3: {
          Label4: while (true) {
          if (!(i < L)) break Label4;
            c = s[i];
            switch (c) {
            case 97:
            case 98:
            case 99:
            case 100:
            case 101:
            case 102:
            case 103:
            case 104:
            case 105:
            case 106:
            case 107:
            case 108:
            case 109:
            case 110:
            case 111:
            case 112:
            case 113:
            case 114:
            case 115:
            case 116:
            case 117:
            case 118:
            case 119:
            case 120:
            case 121:
            case 122:
            case 65:
            case 66:
            case 67:
            case 68:
            case 69:
            case 70:
            case 71:
            case 72:
            case 73:
            case 74:
            case 75:
            case 76:
            case 77:
            case 78:
            case 79:
            case 80:
            case 81:
            case 82:
            case 83:
            case 84:
            case 85:
            case 86:
            case 87:
            case 88:
            case 89:
            case 90:
            case 48:
            case 49:
            case 50:
            case 51:
            case 52:
            case 53:
            case 54:
            case 55:
            case 56:
            case 57:
            case 45:
            case 46:
            case 95:
            case 126:
              addChar(result, c);;
              break;
            case 32:
              result.push.apply(result, fromSpace);;
              break;
            default: 
              addChar(result, 37);;
              result.push.apply(result, toHex(c, 2));;
              break;
            }
            i += 1;
          }
}

function simpleSvgPlaceholder(opts) {
  var result = [];

    var safeText = escapeXml(opts.text);
    var content = [];
    var style = [];
    if (((0 < (opts.darkBgColor).length) || (0 < (opts.darkTextColor).length))) {
    style = nimCopy(null, [60,115,116,121,108,101,62,64,109,101,100,105,97,32,40,112,114,101,102,101,114,115,45,99,111,108,111,114,45,115,99,104,101,109,101,58,32,100,97,114,107,41,32,123], NTI33554449);
    if ((0 < (opts.darkBgColor).length)) {
    style.push.apply(style, ([32,114,101,99,116,32,123,32,102,105,108,108,58,32]).concat(opts.darkBgColor,[59,32,125]));;
    }
    
    if (((0 < (opts.darkTextColor).length) && !(opts.textWrap))) {
    style.push.apply(style, ([32,116,101,120,116,32,123,32,102,105,108,108,58,32]).concat(opts.darkTextColor,[59,32,125]));;
    }
    
    if (((0 < (opts.darkTextColor).length) && opts.textWrap)) {
    style.push.apply(style, ([32,100,105,118,32,123,32,99,111,108,111,114,58,32]).concat(opts.darkTextColor,[32,33,105,109,112,111,114,116,97,110,116,59,32,125]));;
    }
    
    style.push.apply(style, [32,125,60,47,115,116,121,108,101,62]);;
    }
    
    if (opts.textWrap) {
    content = nimCopy(null, ([60,102,111,114,101,105,103,110,79,98,106,101,99,116,32,119,105,100,116,104,61,34]).concat(HEX24(opts.width),[34,32,104,101,105,103,104,116,61,34],HEX24(opts.height),makeNimstrLit("\"><div xmlns=\"http://www.w3.org/1999/xhtml\" style=\"align-items: center; box-sizing: border-box; color: "),opts.textColor,[59,32,100,105,115,112,108,97,121,58,32,102,108,101,120,59,32,102,111,110,116,45,102,97,109,105,108,121,58,32],opts.fontFamily,[59,32,102,111,110,116,45,115,105,122,101,58,32],HEX24(opts.fontSize),[112,120,59,32,102,111,110,116,45,119,101,105,103,104,116,58,32],opts.fontWeight,[59,32,104,101,105,103,104,116,58,32,49,48,48,37,59,32,108,105,110,101,45,104,101,105,103,104,116,58,32],HEX24(opts.lineHeight),[59,32,106,117,115,116,105,102,121,45,99,111,110,116,101,110,116,58,32,99,101,110,116,101,114,59,32,112,97,100,100,105,110,103,58,32],opts.padding,[59,32,116,101,120,116,45,97,108,105,103,110,58,32,99,101,110,116,101,114,59,32,119,105,100,116,104,58,32,49,48,48,37,59,34,62],safeText,[60,47,100,105,118,62,60,47,102,111,114,101,105,103,110,79,98,106,101,99,116,62]), NTI33554449);
    }
    else {
      content = nimCopy(null, ([60,116,101,120,116,32,102,105,108,108,61,34]).concat(opts.textColor,[34,32,102,111,110,116,45,102,97,109,105,108,121,61,34],opts.fontFamily,[34,32,102,111,110,116,45,115,105,122,101,61,34],HEX24(opts.fontSize),[34,32,100,121,61,34],HEX24(opts.dy),[34,32,102,111,110,116,45,119,101,105,103,104,116,61,34],opts.fontWeight,[34,32,120,61,34,53,48,37,34,32,121,61,34,53,48,37,34,32,116,101,120,116,45,97,110,99,104,111,114,61,34,109,105,100,100,108,101,34,62],safeText,[60,47,116,101,120,116,62]), NTI33554449);
    }
    
    var str = ([60,115,118,103,32,120,109,108,110,115,61,34,104,116,116,112,58,47,47,119,119,119,46,119,51,46,111,114,103,47,50,48,48,48,47,115,118,103,34,32,119,105,100,116,104,61,34]).concat(HEX24(opts.width),[34,32,104,101,105,103,104,116,61,34],HEX24(opts.height),[34,32,118,105,101,119,66,111,120,61,34,48,32,48,32],HEX24(opts.width),[32],HEX24(opts.height),[34,62],style,[60,114,101,99,116,32,102,105,108,108,61,34],opts.bgColor,[34,32,119,105,100,116,104,61,34],HEX24(opts.width),[34,32,104,101,105,103,104,116,61,34],HEX24(opts.height),[34,47,62],content,[60,47,115,118,103,62]);
    str = nimCopy(null, cstrToNimstr(toJSStr(str).replace(new RegExp("[\\t\\n\\r]", "g"), "")), NTI33554449);
    str = nimCopy(null, cstrToNimstr(toJSStr(str).replace(new RegExp("\\s\\s+", "g"), " ")), NTI33554449);
    if (opts.dataUri) {
    var encoded = encodeUrl(str, false);
    encoded = nimCopy(null, nsuReplaceStr(encoded, [40], [37,50,56]), NTI33554449);
    encoded = nimCopy(null, nsuReplaceStr(encoded, [41], [37,50,57]), NTI33554449);
    return nimCopy(null, ([100,97,116,97,58,105,109,97,103,101,47,115,118,103,43,120,109,108,59,99,104,97,114,115,101,116,61]).concat(opts.charset,[44],encoded), NTI33554449);
    }
    
    return nimCopy(null, str, NTI33554449);
}
async function handleEvent(request) {
    var Temporary1;

    var url = new URL(request.url);
    url.searchParams.sort();
    var isImageHost = (url.host == "images.placeholders.dev");
    var isApiPath = nsuStartsWith(cstrToNimstr(url.pathname), [47,97,112,105]);
    if ((isImageHost || isApiPath)) {
    var opts = defaultOptions(300, 150);
    opts.dataUri = false;
    var basePath = nsuReplaceStr(cstrToNimstr(url.pathname), [47,97,112,105], []);
    if (!(eqStrings(basePath, [47]))) {
    var size = nsuReplaceStr(basePath, [47], []);
    var parts = nsuSplitString(size, [120], (-1));
    var w = sanitizeNumber(parts[0]);
    if ((1 < (parts).length)) {
    Temporary1 = sanitizeNumber(parts[1]);
    }
    else {
    Temporary1 = none();
    }
    
    var h = nimCopy(null, Temporary1, NTI1191182345);
    if ((isSome(w) && isSome(h))) {
    opts.width = Number(BigInt(Math.trunc(get(w))));
    opts.height = Number(BigInt(Math.trunc(get(h))));
    }
    else {
    if (isSome(w)) {
    opts.width = Number(BigInt(Math.trunc(get(w))));
    opts.height = Number(BigInt(Math.trunc(get(w))));
    }
    }
    }
    
    var sp = url.searchParams;
    var widthParam = sp.get("width");
    if (!((widthParam == null))) {
    var v = sanitizeNumber(cstrToNimstr(widthParam));
    if (isSome(v)) {
    opts.width = Number(BigInt(Math.trunc(get(v))));
    }
    
    }
    
    var heightParam = sp.get("height");
    if (!((heightParam == null))) {
    var v = sanitizeNumber(cstrToNimstr(heightParam));
    if (isSome(v)) {
    opts.height = Number(BigInt(Math.trunc(get(v))));
    }
    
    }
    
    var textParam = sp.get("text");
    if (!((textParam == null))) {
    opts.text = nimCopy(null, sanitizeString(cstrToNimstr(textParam)), NTI33554449);
    }
    
    var fontFamilyParam = sp.get("fontFamily");
    if (!((fontFamilyParam == null))) {
    opts.fontFamily = nimCopy(null, sanitizeStringForCss(cstrToNimstr(fontFamilyParam)), NTI33554449);
    }
    
    var bgColorParam = sp.get("bgColor");
    if (!((bgColorParam == null))) {
    var v = sanitizeColor(cstrToNimstr(bgColorParam));
    if (isSome(v)) {
    opts.bgColor = nimCopy(null, get(v), NTI33554449);
    }
    
    }
    
    var textColorParam = sp.get("textColor");
    if (!((textColorParam == null))) {
    var v = sanitizeColor(cstrToNimstr(textColorParam));
    if (isSome(v)) {
    opts.textColor = nimCopy(null, get(v), NTI33554449);
    }
    
    }
    
    var svg = simpleSvgPlaceholder(opts);
    var headers = {};
    headers["content-type"] = ("image/svg+xml; charset=utf-8");
    headers["access-control-allow-origin"] = ("*");
    headers["Cache-Control"] = (toJSStr(imageCacheHeader));
    var init = {};
    init["headers"] = headers;
    return new Response(toJSStr(svg), init);
    }
    
    var init404 = {};
    init404["status"] = (404);
    return new Response("Not Found", init404);
}

function getCurrentExceptionMsg() {
  var result = [];

    if (!((lastJSError == null))) {
    if (isNimException()) {
    return nimCopy(null, lastJSError.message, NTI33554449);
    }
    else {
      var msg = null;
            if (lastJSError.message !== undefined) {
        msg = lastJSError.message;
      }
      
      if (!((msg == null))) {
      return nimCopy(null, cstrToNimstr(msg), NTI33554449);
      }
      
    }
    
    }
    
    return nimCopy(null, [], NTI33554449);
}
async function fetch(request, env) {

++excHandler;
    try {
    return (await handleEvent(request));
--excHandler;
} catch (EXCEPTION) {
 var prevJSError = lastJSError;
 lastJSError = EXCEPTION;
 --excHandler;
    raiseDefect();
    console.error(toJSStr(getCurrentExceptionMsg()));
    var init = {};
    init["status"] = (500);
    return new Response("Internal Error", init);
    lastJSError = prevJSError;
    } finally {
    }
}
